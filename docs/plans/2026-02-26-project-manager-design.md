# 项目管理系统 V1 设计说明（2026-02-26）

## 1. 背景与目标

- 目标系统定位为“类禅道”的项目管理系统。
- 一期目标是在 2–4 周内完成可上线版本，服务领导视角的数据展示与汇报。
- 核心价值：
  - 对接外部系统并统一项目数据；
  - 展示项目进度与工作量；
  - 可量化体现团队投入与产出。

## 2. 已确认约束

- 后端技术栈：`Spring Boot 3 + JDK 17`。
- 前端实现：由 Gemini 完成。
- 交付策略：一次性上线“模块全覆盖”的 V1。
- 刷新频率：领导看板采用 `T+1` 每日汇总。
- 统计维度：`项目 + 部门 + 人员`。
- 工作量口径：`任务完成量 + 有效工时`。
- 验收标准：功能验收 + 展示验收双达标。

## 3. 方案对比与结论

### 方案 1：高保真复刻禅道

- 优点：认知迁移成本最低。
- 缺点：2–4 周风险极高，不利于单人开发节奏。

### 方案 2：模块全覆盖 + P0 深度控制（最终选择）

- 优点：满足“全量上线”目标，同时通过深度分层控制风险。
- 缺点：高级特性需要在后续迭代补齐。

### 方案 3：看板优先、流程骨架化

- 优点：最快产出领导可见价值。
- 缺点：类禅道属性不足。

**结论：采用方案 2。**

## 4. 总体架构

- 架构形态：单体应用优先。
- 技术组合：`Spring Boot 3 + MySQL + Redis`。
- 单体内按模块分层，便于后续按域拆分。

模块分层建议：

- `auth`：认证、鉴权、会话。
- `org`：组织、用户、角色、权限。
- `pm`：产品/需求/项目/任务/Bug。
- `docs`：知识库。
- `integration`：外部系统适配与同步。
- `dashboard`：领导看板与统计。

## 5. V1 模块范围（P0）

### A. 产品/需求管理

- 闭环：创建需求 → 评审通过 → 拆分任务 → 验收关闭。
- 关键字段：优先级、负责人、计划版本、关联项目。

### B. 项目/任务管理

- 闭环：建项目 → 任务分派 → 执行更新 → 完成验收。
- 支持任务看板与基础进度统计。

### C. Bug 管理

- 闭环：提交 Bug → 指派修复 → 测试验证 → 关闭/重开。
- Bug 可关联需求、任务，进入风险看板。

### G. 组织与权限

- 角色：领导、管理员、项目经理、成员。
- 权限控制：菜单权限 + 接口权限 + 数据范围过滤。

### H. 领导看板

- 指标主线：项目进度、工作量（任务完成量 + 有效工时）。
- 下钻路径：项目 → 部门 → 人员。
- 风险提醒：延期、负荷异常、Bug 堆积。

### I. 知识库

- 文档空间、文档内容、版本记录、访问控制。
- 支撑汇报证据沉淀与项目经验复用。

### J. 外部系统对接

- 一期打通 1 个真实工单系统。
- 实现核心字段双向同步与可追踪日志。
- 采用可插拔适配器接口，便于后续扩展。

## 6. 数据模型（P0）

建议核心表：

- 组织权限：`dept`、`user`、`role`、`permission`、`user_role`、`role_permission`
- 产品需求：`product`、`requirement`、`requirement_history`
- 项目任务：`project`、`project_member`、`task`、`task_worklog`
- 缺陷管理：`bug`、`bug_history`
- 知识库：`doc_space`、`doc_page`、`doc_revision`
- 对接同步：`integration_system`、`integration_mapping`、`sync_job`、`sync_log`
- 看板快照：`metric_daily_snapshot`

## 7. 接口边界（REST）

- `/api/auth/**`：登录、令牌、当前用户
- `/api/org/**`：组织、人员、角色、权限
- `/api/pm/products|requirements|projects|tasks|bugs/**`
- `/api/docs/spaces|pages/**`
- `/api/integrations/**`：系统配置、字段映射、同步任务、日志
- `/api/dashboard/**`：指标查询、下钻、风险视图

## 8. 同步与统计策略

- 统计：每日定时汇总 `T+1` 写入 `metric_daily_snapshot`。
- 同步：定时增量 + 手动触发补偿。
- 幂等：外部映射 ID + 更新时间戳 + 版本号控制。
- 冲突处理：按来源优先级与更新时间规则合并。

## 9. 安全与审计

- 认证授权：接口级权限校验。
- 数据权限：按项目/部门/人员维度过滤。
- 审计范围：状态流转、指派变更、同步写回、权限变更。

## 10. 验收标准

### 功能验收

- `A/B/C/G/H/I/J` 模块全部可用。
- 每个模块至少 1 条主流程可跑通。

### 展示验收

- 看板展示 `项目进度 + 工作量(A+B)`。
- 支持 `项目/部门/人员` 三层下钻。
- 数据为 `T+1` 快照且可按日期查看。

### 对接验收

- 接入 1 个真实工单系统，完成核心字段双向同步。
- 同步日志可追踪、失败可重试。

## 11. 4 周执行节奏

- 第 1 周：`G + A + B` 基础闭环与权限骨架。
- 第 2 周：`C + I` 闭环与基础查询。
- 第 3 周：`H` 看板统计、下钻、风险展示。
- 第 4 周：`J` 双向同步、联调、回归、上线演示。

## 12. 范围控制与风险

- V1 不做复杂自定义流程引擎。
- 对接仅覆盖核心字段，不追求一次性全字段同步。
- 看板先固定模板，不做自由拖拽分析器。

---

本设计为 V1 冻结版本，后续变更通过迭代计划管理。

## 13. 执行快照（2026-02-26）

- 后端已按 P0 实施主链路：`A/B/C/G/H/I/J`。
- 已补充前端对接文档：`docs/apis/openapi-v1.yaml`、`docs/apis/frontend-page-contract.md`。
- 真实外部工单系统对接目前为可插拔骨架（`demo`/`vendor` 适配器），待接入正式系统凭证后切换。
